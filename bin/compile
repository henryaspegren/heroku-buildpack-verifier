#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

# set a key by adding the VERIFIER_KEY to the ENVIR_DIR
echo '-----> Found a identifier.txt'
echo '-----> Looking for VERIFIER_KEY in ENVIR_DIR'

exec `cd $1 && heroku`

# if no key is found the build will be failed
if [ -f $3/VERIFIER_KEY ]; then
  key=$(cat $3/VERIFIER_KEY)
  echo "-----> Key is $key"
else
  echo "-----> Key not found. Build failed."
  exit 1
fi

# if identifier.txt does not contain the key, abort the build
if grep -q $key $1/identifier.txt; then
  echo "Match. Production build authorized"
  exit 0

else
  echo "identifier.txt does not have the required key to push to production. Build failed"
  exit 1
fi

