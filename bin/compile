#!/bin/sh

# set a command by adding VERIFIER_COMMAND to the ENVIR_DIR
echo '-----> Looking for WONDERBREAD_COMMAND in ENVIR_DIR'

# if no WONDERBREAD_COMMAND is found the build will be failed
if [ -f $3/WONDERBREAD_COMMAND ]; then
  WONDERBREAD_COMMAND=$(cat $3/WONDERBREAD_COMMAND)
  echo "-----> Setting command to $WONDERBREAD_COMMAND"
else
  echo "-----> No WONDERBREAD_COMMAND found. Build failed."
  exit 1
fi

echo "-----> Executing command to authorize deployment"

echo $1 $2 $3 | xargs echo $3/WONDERBREAD_COMMAND

# WONDERBREAD_COMMAND is executed and the BUILD_DIR, CACHE and ENVIR_DIR are passed in as arguments.
if `echo $1 $2 $3 | xargs $WONDERBREAD_COMMAND`; then
  # If the command evaluates to true the build proceeds
  echo "       Set command evaluated to true. Build authorized"
  exit 0

else
  # if the command evaluates to fales the build is failed.
  echo "       Set command evaluated to false. Build failed"
  exit 1
fi

